---
phase: 14-supabase-integration
plan: 01
type: execute
wave: 1
depends_on: [13-tech-debt-cleanup]
files_modified: []
autonomous: false
user_setup:
  - "Run supabase/schema.sql in Supabase SQL Editor"
  - "Configure GitHub Secrets for production deployment"
must_haves:
  truths:
    - "Database schema created in Supabase"
    - "All environment variables configured"
    - "Newsletter signup stores to database"
    - "Content posts load from database"
    - "Analytics events stored"
  artifacts:
    - path: "Supabase project"
      provides: "Database with all tables"
  key_links:
    - https://app.supabase.com/project/rzscfynyurvvruobeiyh
---

<objective>
Complete Supabase integration: run database schema, verify environment variables, test all backend features, and run E2E tests.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/milestones/v1.0-phases/14-supabase-integration/14-RESEARCH.md
</context>

<tasks>

<task type="manual" requires_access="supabase">
  <name>Task 1: Run schema.sql in Supabase</name>
  <action>
    1. Navigate to https://app.supabase.com/project/rzscfynyurvvruobeiyh
    2. Click "SQL Editor" in left sidebar
    3. Click "New query"
    4. Copy contents of supabase/schema.sql
    5. Paste into SQL Editor
    6. Click "Run" to execute
    7. Verify "Success" message appears
  </action>
  <verify>Tables appear in Table Editor: cached_awards, sync_status, leads, content_posts, insights, newsletter_subscribers, analytics_events</verify>
  <done>All 7 tables created in Supabase</done>
</task>

<task type="auto">
  <name>Task 2: Verify environment variables</name>
  <action>
    Check .env.local has correct Supabase configuration:
    - NEXT_PUBLIC_SUPABASE_URL=https://rzscfynyurvvruobeiyh.supabase.co
    - NEXT_PUBLIC_SUPABASE_ANON_KEY=<key present>
    - SUPABASE_SERVICE_ROLE_KEY=<key present> (server-side only)
  </action>
  <verify>All required variables present in .env.local</verify>
  <done>Environment configuration verified</done>
</task>

<task type="auto">
  <name>Task 3: Test local dev with Supabase</name>
  <action>
    Run local development server:
    ```bash
    npm run dev
    ```
    - Verify app loads without Supabase connection errors
    - Check browser console for Supabase initialization
  </action>
  <verify>Dev server starts and connects to Supabase</verify>
  <done>Local dev server works with Supabase</done>
</task>

<task type="auto">
  <name>Task 4: Test newsletter signup</name>
  <action>
    1. Navigate to /newsletter
    2. Enter test email: test@example.com
    3. Submit signup form
    4. Check Supabase: newsletter_subscribers table should have new row
  </action>
  <verify>New subscriber appears in Supabase table</verify>
  <done>Newsletter signup stores to database</done>
</task>

<task type="auto">
  <name>Task 5: Test content loading</name>
  <action>
    1. Navigate to /content
    2. Verify content loads from Supabase (not fallback)
    3. Check Supabase: content_posts table query returns results
  </action>
  <verify>Content loads from database (not fallback)</verify>
  <done>Content system reads from Supabase</done>
</task>

<task type="auto">
  <name>Task 6: Test analytics event storage</name>
  <action>
    1. Navigate through several pages
    2. Trigger analytics event (page view)
    3. Check Supabase: analytics_events table should have new rows
  </action>
  <verify>Events appear in analytics_events table</verify>
  <done>Analytics events stored</done>
</task>

<task type="auto">
  <name>Task 7: Test lead capture</name>
  <action>
    1. Navigate to /assess
    2. Enter email to access self-assessment
    3. Submit email gate form
    4. Check Supabase: leads table should have new row
  </action>
  <verify>Lead appears in leads table</verify>
  <done>Lead capture stores to database</done>
</task>

<task type="auto">
  <name>Task 8: Run test suite</name>
  <action>
    Run unit tests and verify they pass:
    ```bash
    npm test
    ```
  </action>
  <verify>All tests pass</verify>
  <done>Test suite passes</done>
</task>

<task type="auto">
  <name>Task 9: Run E2E tests</name>
  <action>
    Run Playwright tests:
    ```bash
    npx playwright test
    ```
  </action>
  <verify>E2E tests pass</verify>
  <done>E2E tests pass</done>
</task>

<task type="auto">
  <name>Task 10: Verify static build</name>
  <action>
    Run static build:
    ```bash
    npm run build:static
    ```
    Note: Static build uses fallback content when Supabase unavailable
  </action>
  <verify>Static build completes</verify>
  <done>Static build succeeds</done>
</task>

</tasks>

<verification>
- All 7 tables exist in Supabase
- Newsletter signup creates row in newsletter_subscribers
- Content loads from content_posts (not fallback)
- Analytics events stored in analytics_events
- Leads stored in leads table
- npm test passes
- npx playwright test passes
- npm run build:static succeeds
</verification>

<success_criteria>
- Task 1: Supabase schema executed successfully
- Task 2: Environment variables verified
- Task 3-7: Each backend feature tested and working
- Task 8-10: Tests and builds pass
- Summary created with verification results
</success_criteria>

<output>
After completion, create `.planning/milestones/v1.0-phases/14-supabase-integration/14-01-SUMMARY.md`
</output>
