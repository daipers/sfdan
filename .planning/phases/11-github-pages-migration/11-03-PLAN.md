---
phase: 11-github-pages-migration
plan: 03
type: execute
wave: 3
depends_on: ["11-01", "11-02"]
files_modified: [.env.example, .github/workflows/deploy.yml, package.json, README.md]
autonomous: true
user_setup: 
  - service: github-pages
    why: "Enable GitHub Pages in repository settings"
    dashboard_config:
      - task: "Enable GitHub Pages in repository settings"
        location: "Repository Settings > Pages > Source > GitHub Actions"

must_haves:
  truths:
    - "Environment variables are properly configured for static export"
    - "GitHub Pages deployment succeeds via GitHub Actions"
    - "Site loads correctly at GitHub Pages URL"
    - "All functionality works in static environment"
  artifacts:
    - path: ".env.example"
      provides: "Environment variable documentation for GitHub Pages"
    - path: ".github/workflows/deploy.yml"
      provides: "Complete deployment workflow with secrets"
    - path: "README.md"
      provides: "Updated deployment instructions"
  key_links:
    - from: "GitHub Actions"
      to: "GitHub Pages"
      via: "deployment"
      pattern: "deploy-pages@v4"
---

<objective>
Complete GitHub Pages migration with environment configuration, deployment verification, and documentation updates.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/11-github-pages-migration/11-01-PLAN.md
@.planning/phases/11-github-pages-migration/11-02-PLAN.md
@.github/workflows/deploy.yml
@package.json
</context>

<tasks>

<task type="auto">
  <name>Configure environment variables for static export</name>
  <files>.env.example, .github/workflows/deploy.yml</files>
  <action>
1. Create .env.example with GitHub Pages configuration:
```bash
# GitHub Pages Configuration
NEXT_PUBLIC_PAGES_BASE_PATH="/sfdan"
STATIC_EXPORT=true

# API Configuration (for client-side use)
NEXT_PUBLIC_SUPABASE_URL="your-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-supabase-anon-key"

# Optional: Analytics and Monitoring
NEXT_PUBLIC_SENTRY_DSN=""
SENTRY_ENVIRONMENT="production"

# Optional: Rate Limiting
UPSTASH_REDIS_REST_URL=""
UPSTASH_REDIS_REST_TOKEN=""

# Optional: Insights Generation
INSIGHTS_CRON_SECRET=""
```

2. Update .github/workflows/deploy.yml to include environment secrets:
```yaml
# Add to the build job's env section
env:
  NEXT_PUBLIC_PAGES_BASE_PATH: "/${{ github.event.repository.name }}"
  STATIC_EXPORT: 'true'
  NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
  NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}
  NEXT_PUBLIC_SENTRY_DSN: ${{ secrets.SENTRY_DSN }}
  SENTRY_ENVIRONMENT: 'production'
  SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
```
  </action>
  <verify>
Environment variables are properly referenced in workflow
  </verify>
  <done>Environment configuration completed</done>
</task>

<task type="auto">
  <name>Add GitHub Pages deployment dependencies</name>
  <files>package.json</files>
  <action>
Add necessary dependencies for GitHub Pages deployment:

```json
{
  "devDependencies": {
    "gh-pages": "^6.1.1"
  }
}
```

Also update the deploy script to be more robust:
```json
{
  "scripts": {
    "predeploy": "echo '' > out/.nojekyll && echo 'Static site generated for GitHub Pages'",
    "deploy:gh-pages": "npm run build:static && npm run predeploy && gh-pages -d out -b gh-pages -f",
    "deploy:local": "npm run build:static && npm run predeploy"
  }
}
```
  </action>
  <verify>
npm install completes successfully
  </verify>
  <done>Deployment dependencies added</done>
</task>

<task type="auto">
  <name>Update README with GitHub Pages deployment instructions</name>
  <files>README.md</files>
  <action>
Add GitHub Pages deployment section to README.md:

```markdown
## GitHub Pages Deployment

This project is configured for deployment to GitHub Pages with static export.

### Prerequisites

1. Repository must be public (GitHub Pages requirement)
2. GitHub Pages must be enabled in repository settings
3. Required environment variables must be configured

### Environment Variables

Create a `.env.local` file with:

```bash
NEXT_PUBLIC_PAGES_BASE_PATH="/your-repo-name"
STATIC_EXPORT=true
NEXT_PUBLIC_SUPABASE_URL="your-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-supabase-anon-key"
```

### Local Development

```bash
# Development server
npm run dev

# Static build (for GitHub Pages)
npm run build:static

# Test static build locally
npm run deploy:local
```

### Deployment

#### Automatic (GitHub Actions)

Pushes to `main` branch automatically deploy via GitHub Actions.

#### Manual (Local)

```bash
npm run deploy:gh-pages
```

### Important Notes

- API routes are converted to client-side functions
- Dynamic server-side features are disabled
- Images are served statically without optimization
- Base path is automatically set based on repository name
```
  </action>
  <verify>
README.md contains complete GitHub Pages deployment instructions
  </verify>
  <done>Documentation updated with deployment instructions</done>
</task>

<task type="auto">
  <name>Test static build and verify functionality</name>
  <files>package.json</files>
  <action>
Run comprehensive tests to ensure the static export works correctly:

```bash
# Test static build
npm run build:static

# Verify output structure
ls -la out/
ls -la out/index.html
ls -la out/404.html

# Check for any API route references
grep -r "\/api\/" out/ || echo "No API references found"

# Test local server with static files
npx serve out -p 3000

echo "Static build test completed. Visit http://localhost:3000 to verify."
```

The build should complete without errors and generate static HTML files in the `out/` directory.
  </action>
  <verify>
Static build completes and out/ directory contains HTML files
  </verify>
  <done>Static build verification completed</done>
</task>

</tasks>

<verification>
- Enable GitHub Pages in repository settings
- Configure required secrets in GitHub repository
- Test deployment workflow on feature branch
- Verify site loads at GitHub Pages URL
- Test all functionality works correctly
</verification>

<success_criteria>
- [ ] GitHub Pages is enabled in repository settings
- [ ] GitHub Actions workflow deploys successfully
- [ ] Site loads at https://[username].github.io/[repo-name]/
- [ ] All pages render correctly without errors
- [ ] Client-side functionality works (export, filters, etc.)
- [ ] No 404 errors on navigation
- [ ] Documentation is complete and accurate
</success_criteria>

<output>
After completion, create `.planning/phases/11-github-pages-migration/11-03-SUMMARY.md`
</output>